## Telegram Task Bot (python-telegram-bot)

Простой Telegram-бот для управления задачами: создание задач, приоритизация по дедлайну, напоминания за 1 день, формирование чеклистов.

Добавлена интеграция с новостями через NewsAPI.

### Возможности
- Создание задач из текста: `/newtask {текст}` — далее бот запросит дедлайн
- Список активных задач: `/alltasks` (id, приоритет, дедлайн, текст)
- Завершение задачи: `/completetask {id}`
- Чеклист по задачам: `/todo {список id}` — соберёт чеклист из текстов задач
- Хранение в SQLite (`tasks.db`), напоминания за 1 день до дедлайна

Новости (через [NewsAPI](https://newsapi.org/)):
- `/categories` — доступные категории
- `/news` — показать интерактивные кнопки с категориями новостей (рекомендуется)
- `/news {категория}` — последние заголовки по категории (учитывает выбранную страну)
- `/country {код}` — установить страну (двухбуквенный код, по умолчанию `us`)
- `/sources` — список источников (по умолчанию язык `en`)
- `/source {id}` — последние заголовки с указанного источника

Приоритеты рассчитываются автоматически по времени до дедлайна:
- High: ≤ 2 дней
- Medium: ≤ 7 дней
- Low: > 7 дней или без дедлайна

### Требования
- Python 3.9+
- Токен Telegram-бота (от `@BotFather`)
- Ключ NewsAPI (`NEWSAPI_KEY`) для новостных команд

### Установка
1. Склонируйте репозиторий или поместите файлы в папку проекта.
2. Создайте и активируйте виртуальное окружение (рекомендуется):
```bash
python -m venv .venv
.venv\\Scripts\\activate
```
3. Установите зависимости:
```bash
pip install -r requirements.txt
```
4. Создайте файл `.env` и укажите токены:
```env
BOT_TOKEN=ваш_токен_бота
# DB_PATH=tasks.db  # необязательно
NEWSAPI_KEY=ваш_newsapi_key
```

### Запуск
```bash
python bot.py
```

Бот стартует в режиме long polling. Для остановки нажмите Ctrl+C.

### Использование
- `/start` или `/help` — подсказка по командам
- `/newtask Задача подготовить отчёт` → бот спросит дедлайн в формате `YYYY-MM-DD` или `YYYY-MM-DD HH:MM` (локальное время). Если указана только дата, время по умолчанию — 09:00.
- `/alltasks` — выводит активные задачи с приоритетами, дедлайном (UTC) и текстом.
- `/completetask 3` — завершит задачу с id=3 и отменит её напоминание.
- `/todo 1 2 5` — сформирует чеклист из задач 1, 2 и 5. Если текст превышает лимит Telegram (4096 символов), будет обрезан.

Команды новостей:
- `/categories` — показать список всех доступных категорий
- `/country us` (или другой код: `gb`, `de`, `ee`, ...) — установить страну для новостей
- `/news` — показать кнопки с категориями (просто нажмите на нужную кнопку)
- `/news business` — получить новости напрямую (альтернатива кнопкам)
- `/sources` — список популярных источников новостей
- `/source techcrunch` — получить новости от конкретного источника

### Примечания по времени и напоминаниям
- Дедлайны вы указываете в своём локальном времени. Бот преобразует его в UTC без внешних таймзонных библиотек и планирует напоминание за 1 день до дедлайна.
- Если напоминание рассчитано на прошедшее время, оно не будет запланировано.
- При перезапуске бота напоминания для незавершённых задач пересоздаются автоматически.

### Структура данных (SQLite)
Таблица `tasks`:
- `id` INTEGER PRIMARY KEY AUTOINCREMENT
- `chat_id` INTEGER NOT NULL
- `text` TEXT NOT NULL
- `deadline_utc_iso` TEXT NULL (ISO-строка в UTC)
- `completed` INTEGER NOT NULL DEFAULT 0

### Обработка ошибок
- Команды валидируются на корректность входных данных.
- Неверные форматы дат подсвечиваются и запрашиваются повторно.
- Сообщения и длинные списки корректно дробятся/обрезаются до лимита Telegram.
- Для новостей: сетевые ошибки и ошибки API аккуратно обрабатываются и выводится понятное сообщение.

### Интерактивные кнопки
- Команда `/news` без параметров показывает inline-кнопки со всеми доступными категориями новостей.
- Просто нажмите на нужную кнопку, чтобы получить новости по выбранной категории.
- Кнопки автоматически исчезают после выбора категории.
- Поддержана как работа через кнопки, так и через текстовые команды для совместимости.

### Разработка
- Основной файл бота: `bot.py`
- Зависимости: `requirements.txt`
- Конфигурация: `.env` (пример в `.env.example`)

### Лицензия
MIT (или по вашему выбору)


